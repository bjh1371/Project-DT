////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// \file CAsyncEventSink.cpp
/// \author 
/// \date 2014.11.5
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "AsyncEventSink.h"

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// \brief 생성자
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
CAsyncEventSink::CAsyncEventSink()
:
m_PendingDeletion(false)
{
	SafeGuard();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// \brief 소멸자
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
CAsyncEventSink::~CAsyncEventSink()
{
	SafeGuard();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// \brief 
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CAsyncEventSink::OnTimer(CAsyncTimerEvent* evt)
{
	assert(false && "never in here");
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// \brief 객체를 삭제한다.
/// \return void
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CAsyncEventSink::Destroy()
{
	SafeGuard();

	if (ExChangePendingDeletion(false) == true)
	{
		DestroyInternal();
	}
	else
	{
		TRACE(_T("pending deletion is invalid"));
	}
}


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// \brief 객체를 실제 삭제하는 함수
/// \return void
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void CAsyncEventSink::DestroyInternal()
{
	SafeGuard();

	xdelete(this);
}
