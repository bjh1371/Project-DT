////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// \file ESPKTEchoHandler.cpp
/// \author bjh1371
/// \date 2015.8.9
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "ESPKTEchoHandler.h"

#include "EchoClient.h"

#include "Base/AsyncTcpPeer.h"

namespace
{
	void Stop(CAsyncTcpPeer* peer)
	{
		static int count = 0;

		++count;

		if (count == 100000)
			peer->PostDisconnect(CAsyncTcpEvent::DR_FORCE);
	}
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/// \brief 에코 패킷
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
int CESPKTEchoHandler::Execute(CAsyncTcpPeer* peer, char* buf, int len)
{
	CPacketReader<PKTEcho> pktEcho(buf, len);
	if (pktEcho.GetLength() == len)
	{
		CPacketWriter<PKTEcho> echo;
		echo->SetStr(pktEcho->GetStr());

		peer->PostSend(echo);

		Stop(peer);
	}

	return pktEcho.GetLength();
}
